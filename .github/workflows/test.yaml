name: Build and Run Workflow

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install CMake, Clang and Conan
      run: |
        sudo apt-get update
        sudo apt-get install -y cmake clang
        sudo apt-get install -y python3-pip
        sudo apt-get install -y tree
        pip3 install conan

    - name: Set Conan Profile
      run: conan profile detect --force

    - name: Install dependencies
      run: conan install . -sbuild_type=Release -of=build --build=missing

    - name: TREE
      run: tree

    - name: Generate build files
      run: cmake -S . -B build -DCMAKE_TOOLCHAIN_FILE=conan_toolchain.cmake -DCONAN=ON -DCMAKE_BUILD_TYPE=Release

    - name: Build the project
      run: cmake --build build

    # If you want to run the executable add this step
    - name: Run the executable
      run: cmake --build build --target runTest

    # For a clean build, you can prepend the build step with `--clean-first`
    # - name: Clean build
    #   run: cmake --build build --clean-first